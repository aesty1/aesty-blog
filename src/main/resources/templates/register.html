<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | –ë–ª–æ–≥</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #334155;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .register-container {
            width: 100%;
            max-width: 480px;
        }

        /* Header */
        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1e40af;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .logo:hover {
            color: #3b82f6;
        }

        .tagline {
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Register Card */
        .register-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(30, 64, 175, 0.12);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            padding: 2.5rem;
        }

        .card-header {
            margin-bottom: 2rem;
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: #64748b;
            font-size: 1rem;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            margin-bottom: 2rem;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 16px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .progress-bar {
            position: absolute;
            top: 16px;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            z-index: 2;
            transition: width 0.3s ease;
        }

        .step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        .step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-label {
            font-size: 0.85rem;
            color: #94a3b8;
            text-align: center;
            transition: color 0.3s ease;
        }

        .step.active .step-label {
            color: #1e293b;
            font-weight: 500;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-label.required::after {
            content: " *";
            color: #ef4444;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input::placeholder {
            color: #94a3b8;
        }

        .password-wrapper {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.1rem;
        }

        .toggle-password:hover {
            color: #3b82f6;
        }

        /* Password Requirements */
        .password-requirements {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .requirement {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            color: #64748b;
        }

        .requirement.valid {
            color: #10b981;
        }

        .requirement.invalid {
            color: #ef4444;
        }

        .requirement-icon {
            font-size: 0.9rem;
        }

        /* Password Strength */
        .password-strength {
            margin-top: 0.5rem;
        }

        .strength-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }

        .strength-text {
            font-size: 0.8rem;
            color: #94a3b8;
            text-align: right;
        }

        /* Terms and Conditions */
        .terms-group {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .terms-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            margin-top: 0.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .terms-checkbox.checked {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .terms-checkbox.checked::after {
            content: "‚úì";
            color: white;
            font-size: 12px;
        }

        .terms-text {
            font-size: 0.9rem;
            color: #475569;
            line-height: 1.5;
        }

        .terms-link {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }

        .terms-link:hover {
            text-decoration: underline;
        }

        /* Register Button */
        .register-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 64, 175, 0.25);
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
        }

        .register-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.2);
        }

        .register-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .register-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .register-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        /* Login Link */
        .login-section {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #f1f5f9;
        }

        .login-text {
            color: #64748b;
            margin-bottom: 1rem;
        }

        .login-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            background: transparent;
            color: #1e40af;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
        }

        .login-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        /* Error Messages */
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid #fecaca;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
        }

        .error-message::before {
            content: "‚ö†Ô∏è";
            font-size: 1.2rem;
        }

        .input-error {
            border-color: #dc2626 !important;
            background-color: #fef2f2;
        }

        .error-text {
            color: #dc2626;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Success Message */
        .success-message {
            background: #f0fdf4;
            color: #059669;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid #a7f3d0;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
        }

        .success-message::before {
            content: "‚úÖ";
            font-size: 1.2rem;
        }

        /* Footer */
        .register-footer {
            text-align: center;
            margin-top: 2rem;
            color: #94a3b8;
            font-size: 0.85rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.5rem;
        }

        .footer-links a {
            color: #94a3b8;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: #64748b;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .register-card {
                padding: 2rem 1.5rem;
            }

            .progress-steps {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .progress-steps::before,
            .progress-bar {
                display: none;
            }

            .step {
                flex-direction: row;
                gap: 0.75rem;
                width: 100%;
            }

            .step-number {
                margin-bottom: 0;
            }

            .footer-links {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<div class="register-container">
    <!-- Header -->
    <div class="register-header">
        <a href="/" class="logo">
            <span class="logo-icon">‚úçÔ∏è</span>
            <span>ThoughtFlow</span>
        </a>
        <p class="tagline">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É –º—ã—Å–ª–∏—Ç–µ–ª–µ–π</p>
    </div>

    <!-- Register Card -->
    <div class="register-card">
        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="progress-bar" id="progressBar" style="width: 33%"></div>
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            </div>
        </div>

        <div class="card-header">
            <h2 class="card-title">–°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
            <p class="card-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" th:if="${param.error}">
            –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
        </div>

        <!-- Success Message -->
        <div class="success-message" th:if="${param.success}">
            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.
        </div>

        <!-- Registration Form -->
        <form th:action="@{/register}" method="POST" th:object="${author}" id="registerForm">
            <!-- Nickname Field -->
            <div class="form-group">
                <label for="nickname" class="form-label required">–ù–∏–∫–Ω–µ–π–º</label>
                <input type="text"
                       id="nickname"
                       name="nickname"
                       th:field="*{nickname}"
                       class="form-input"
                       placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º"
                       maxlength="30"
                       required
                       oninput="validateNickname()">
                <div class="char-counter" id="nicknameCounter" style="text-align: right; font-size: 0.85rem; color: #94a3b8; margin-top: 0.25rem;">
                    <span id="nicknameLength">0</span>/30
                </div>
                <div class="error-text" th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}">
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º
                </div>
                <div class="error-text" id="nicknameError" style="display: none;">
                    –ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 3 –¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤
                </div>
            </div>

            <!-- Email Field -->
            <div class="form-group">
                <label for="email" class="form-label required">Email</label>
                <input type="email"
                       id="email"
                       name="email"
                       th:field="*{email}"
                       class="form-input"
                       placeholder="example@email.com"
                       required
                       oninput="validateEmail()">
                <div class="error-text" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email
                </div>
                <div class="error-text" id="emailError" style="display: none;">
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å
                </div>
            </div>

            <!-- Password Field -->
            <div class="form-group">
                <label for="password" class="form-label required">–ü–∞—Ä–æ–ª—å</label>
                <div class="password-wrapper">
                    <input type="password"
                           id="password"
                           name="password"
                           th:field="*{password}"
                           class="form-input"
                           placeholder="–°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å"
                           required
                           oninput="validatePassword()">
                    <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>

                <!-- Password Requirements -->
                <div class="password-requirements" id="passwordRequirements">
                    <div class="requirement" id="reqLength">
                        <span class="requirement-icon">‚≠ï</span>
                        <span>–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</span>
                    </div>
                    <div class="requirement" id="reqUppercase">
                        <span class="requirement-icon">‚≠ï</span>
                        <span>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞</span>
                    </div>
                    <div class="requirement" id="reqLowercase">
                        <span class="requirement-icon">‚≠ï</span>
                        <span>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞</span>
                    </div>
                    <div class="requirement" id="reqNumber">
                        <span class="requirement-icon">‚≠ï</span>
                        <span>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞</span>
                    </div>
                </div>

                <!-- Password Strength -->
                <div class="password-strength" id="passwordStrength" style="display: none;">
                    <div class="strength-bar">
                        <div class="strength-fill" id="strengthFill"></div>
                    </div>
                    <div class="strength-text" id="strengthText">–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å</div>
                </div>

                <div class="error-text" th:if="${#fields.hasErrors('password')}" th:errors="*{password}">
                    –ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
                </div>
            </div>

            <!-- Confirm Password Field -->
            <div class="form-group">
                <label for="confirmPassword" class="form-label required">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                <div class="password-wrapper">
                    <input type="password"
                           id="confirmPassword"
                           name="confirmPassword"
                           class="form-input"
                           placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                           required
                           oninput="validateConfirmPassword()">
                    <button type="button" class="toggle-password" onclick="toggleConfirmPassword()">üëÅÔ∏è</button>
                </div>
                <div class="error-text" id="confirmPasswordError" style="display: none;">
                    –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="terms-group">
                <div class="terms-checkbox" id="termsCheckbox" onclick="toggleTerms()"></div>
                <div class="terms-text">
                    –Ø —Å–æ–≥–ª–∞—à–∞—é—Å—å —Å
                    <a href="#" class="terms-link">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                    –∏
                    <a href="#" class="terms-link">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
                    <div class="error-text" id="termsError" style="display: none; margin-top: 0.5rem;">
                        –í—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω—è—Ç—å —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                    </div>
                </div>
            </div>

            <!-- Register Button -->
            <button type="submit" class="register-btn" id="registerButton" disabled>
                <span id="buttonText">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
                <div class="spinner" id="spinner"></div>
            </button>
        </form>

        <!-- Login Link -->
        <div class="login-section">
            <p class="login-text">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
            <a th:href="@{/login}" class="login-btn">
                <span>–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</span>
            </a>
        </div>
    </div>

    <!-- Footer -->
    <div class="register-footer">
        <p>¬© 2024 ThoughtFlow. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <div class="footer-links">
            <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
            <a href="#">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
            <a href="#">–ü–æ–º–æ—â—å</a>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const registerForm = document.getElementById('registerForm');
        const registerButton = document.getElementById('registerButton');
        const buttonText = document.getElementById('buttonText');
        const spinner = document.getElementById('spinner');

        // Update progress steps
        function updateProgress(step) {
            const steps = document.querySelectorAll('.step');
            const progressBar = document.getElementById('progressBar');

            steps.forEach((s, index) => {
                s.classList.remove('active', 'completed');
                if (index < step) {
                    s.classList.add('completed');
                }
            });

            steps[step - 1].classList.add('active');
            progressBar.style.width = `${(step - 1) * 33.33}%`;
        }

        // Initialize progress based on form state
        updateProgress(1);

        // Toggle password visibility
        window.togglePassword = function() {
            const passwordInput = document.getElementById('password');
            const toggleButton = passwordInput.nextElementSibling;

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        };

        window.toggleConfirmPassword = function() {
            const confirmInput = document.getElementById('confirmPassword');
            const toggleButton = confirmInput.nextElementSibling;

            if (confirmInput.type === 'password') {
                confirmInput.type = 'text';
                toggleButton.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                confirmInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        };

        // Toggle terms checkbox
        window.toggleTerms = function() {
            const checkbox = document.getElementById('termsCheckbox');
            checkbox.classList.toggle('checked');
            validateForm();
        };

        // Form validation functions
        window.validateNickname = function() {
            const nicknameInput = document.getElementById('nickname');
            const nicknameError = document.getElementById('nicknameError');
            const nicknameLength = document.getElementById('nicknameLength');

            nicknameLength.textContent = nicknameInput.value.length;

            if (nicknameInput.value.length < 3 || nicknameInput.value.length > 30) {
                nicknameError.style.display = 'flex';
                nicknameInput.classList.add('input-error');
                return false;
            } else {
                nicknameError.style.display = 'none';
                nicknameInput.classList.remove('input-error');
                return true;
            }
        };

        window.validateEmail = function() {
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(emailInput.value)) {
                emailError.style.display = 'flex';
                emailInput.classList.add('input-error');
                return false;
            } else {
                emailError.style.display = 'none';
                emailInput.classList.remove('input-error');
                return true;
            }
        };

        window.validatePassword = function() {
            const passwordInput = document.getElementById('password');
            const requirements = document.getElementById('passwordRequirements');
            const strength = document.getElementById('passwordStrength');
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');

            const password = passwordInput.value;

            // Check requirements
            const hasLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);

            // Update requirement indicators
            updateRequirement('reqLength', hasLength);
            updateRequirement('reqUppercase', hasUppercase);
            updateRequirement('reqLowercase', hasLowercase);
            updateRequirement('reqNumber', hasNumber);

            // Calculate password strength
            let strengthValue = 0;
            if (hasLength) strengthValue += 25;
            if (hasUppercase) strengthValue += 25;
            if (hasLowercase) strengthValue += 25;
            if (hasNumber) strengthValue += 25;

            // Update strength meter
            strengthFill.style.width = `${strengthValue}%`;

            if (strengthValue === 0) {
                strength.style.display = 'none';
            } else {
                strength.style.display = 'block';
                if (strengthValue <= 25) {
                    strengthFill.style.background = '#ef4444';
                    strengthText.textContent = '–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å';
                } else if (strengthValue <= 50) {
                    strengthFill.style.background = '#f59e0b';
                    strengthText.textContent = '–°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å';
                } else if (strengthValue <= 75) {
                    strengthFill.style.background = '#3b82f6';
                    strengthText.textContent = '–•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å';
                } else {
                    strengthFill.style.background = '#10b981';
                    strengthText.textContent = '–û—Ç–ª–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!';
                }
            }

            // Validate confirm password if it has value
            if (document.getElementById('confirmPassword').value) {
                validateConfirmPassword();
            }

            return hasLength && hasUppercase && hasLowercase && hasNumber;
        };

        function updateRequirement(elementId, isValid) {
            const element = document.getElementById(elementId);
            element.classList.remove('valid', 'invalid');
            element.classList.add(isValid ? 'valid' : 'invalid');
            element.querySelector('.requirement-icon').textContent = isValid ? '‚úÖ' : '‚ùå';
        }

        window.validateConfirmPassword = function() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmError = document.getElementById('confirmPasswordError');

            if (password !== confirmPassword) {
                confirmError.style.display = 'flex';
                document.getElementById('confirmPassword').classList.add('input-error');
                return false;
            } else {
                confirmError.style.display = 'none';
                document.getElementById('confirmPassword').classList.remove('input-error');
                return true;
            }
        };

        // Master form validation
        function validateForm() {
            const isNicknameValid = validateNickname();
            const isEmailValid = validateEmail();
            const isPasswordValid = validatePassword();
            const isConfirmValid = validateConfirmPassword();
            const isTermsAccepted = document.getElementById('termsCheckbox').classList.contains('checked');

            const termsError = document.getElementById('termsError');
            if (!isTermsAccepted) {
                termsError.style.display = 'block';
            } else {
                termsError.style.display = 'none';
            }

            const isValid = isNicknameValid && isEmailValid && isPasswordValid && isConfirmValid && isTermsAccepted;

            registerButton.disabled = !isValid;

            // Update progress based on validation
            if (isNicknameValid && isEmailValid) {
                updateProgress(2);
            }
            if (isPasswordValid && isConfirmValid) {
                updateProgress(3);
            }

            return isValid;
        }

        // Add event listeners for real-time validation
        const inputs = ['nickname', 'email', 'password', 'confirmPassword'];
        inputs.forEach(inputId => {
            document.getElementById(inputId).addEventListener('input', validateForm);
        });

        // Form submission
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            // Show loading state
            buttonText.style.display = 'none';
            spinner.style.display = 'block';
            registerButton.disabled = true;

            // Submit form after validation
            setTimeout(() => {
                registerForm.submit();
            }, 1000);
        });

        // Auto-focus nickname field
        document.getElementById('nickname').focus();

        // Initialize form validation
        validateForm();
    });
</script>
</body>
</html>